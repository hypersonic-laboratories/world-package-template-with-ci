name: "Create Package Archive"
description: "Creates a gzipped tar archive from content and optional scripts folders"

outputs:
  archive-path:
    description: "Path to the created archive file"
    value: ${{ steps.create-tar.outputs.archive-path }}
  archive-size:
    description: "Size of the archive in bytes"
    value: ${{ steps.get-size.outputs.archive-size }}

runs:
  using: "composite"
  steps:
    - name: Validate required folders
      shell: bash
      run: |
        if [ ! -d "content" ]; then
          echo "âŒ Error: 'content' folder is required but not found"
          exit 1
        fi
        echo "âœ… Content folder found"

        if [ -d "scripts" ]; then
          echo "âœ… Scripts folder found"
          echo "HAS_SCRIPTS=true" >> $GITHUB_ENV
        else
          echo "â„¹ï¸  Scripts folder not found (optional)"
          echo "HAS_SCRIPTS=false" >> $GITHUB_ENV
        fi

    - name: Create archive
      id: create-tar
      shell: bash
      run: |
        ARCHIVE_PATH="content.tar.gz"

        if [ "$HAS_SCRIPTS" = "true" ]; then
          echo "Creating archive with content and scripts..."
          tar -czf "$ARCHIVE_PATH" -C "." "content" "scripts"
        else
          echo "Creating archive with content only..."
          tar -czf "$ARCHIVE_PATH" -C "." "content"
        fi

        echo "archive-path=$ARCHIVE_PATH" >> $GITHUB_OUTPUT
        echo "âœ… Archive created: $ARCHIVE_PATH"

    - name: Get archive size
      id: get-size
      shell: bash
      run: |
        ARCHIVE_PATH="${{ steps.create-tar.outputs.archive-path }}"
        ARCHIVE_SIZE=$(stat -c%s "$ARCHIVE_PATH" 2>/dev/null || stat -f%z "$ARCHIVE_PATH")
        echo "archive-size=$ARCHIVE_SIZE" >> $GITHUB_OUTPUT
        echo "ðŸ“¦ Archive size: $ARCHIVE_SIZE bytes"
